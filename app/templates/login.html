{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">

<div class="login-container">
    <h2>Welcome Back</h2>
    <p>Select your role and sign in</p>

    <div class="role-selection">
        <button class="btn btn-role" id="student-btn" onclick="selectRole('student')">Student</button>
        <button class="btn btn-role" id="instructor-btn" onclick="selectRole('instructor')">Instructor</button>
    </div>

    <form id="loginForm" style="display:none;" onsubmit="submitLogin(event)">
        <div class="form-group">
            <label for="email">Email Address</label>
            <input id="email" name="email" type="email" class="form-control" placeholder="you@example.com" required>
        </div>
    
        <div class="form-group">
            <label for="password">Password</label>
            <input id="password" name="password" type="password" class="form-control" placeholder="••••••••" required>
        </div>

        <input type="hidden" id="role" name="role">
    
        <button type="submit" class="btn btn-primary w-100 mt-3">Sign In</button>
    </form>

    <p style="text-align: center; margin-top: 1.5rem;">
        Don't have an account? <a href="/" style="font-weight: 500;">Sign up</a>
    </p>
</div>
{% endblock %}

{% block scripts %}
<script>
function selectRole(role) {
    const buttons = document.querySelectorAll('.btn-role');
    buttons.forEach(btn => btn.classList.remove('active-role'));

    const selectedBtn = document.getElementById(`${role}-btn`);
    selectedBtn.classList.add('active-role');

    document.getElementById('role').value = role;
    document.getElementById('loginForm').style.display = 'block';
}

function submitLogin(event) {
    event.preventDefault();

    const data = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        role: document.getElementById('role').value
    };

    fetch('/api/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(r => r.json())
    .then(response => {
        if (response.success) {
            window.location.href = response.redirect;
        } else {
            alert(response.message || 'Login failed. Try again.');
        }
    })
    .catch(() => alert('Error during login.'));
}
</script>
{% endblock %}