{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">

<div class="signup-container">
    <h2>Create an Account</h2>
    <p>Select your role and fill in your details below.</p>

    <div class="role-selection">
        <button class="btn btn-role" id="student-btn" onclick="selectRole('student')">Student</button>
        <button class="btn btn-role" id="instructor-btn" onclick="selectRole('instructor')">Instructor</button>
    </div>

    <form id="signupForm" style="display:none;" onsubmit="submitSignup(event)">
        <div class="form-group">
            <label for="name">Full Name</label>
            <input id="name" name="name" class="form-control" placeholder="Enter your name" required>
        </div>
    
        <div class="form-group">
            <label for="email">Email Address</label>
            <input id="email" name="email" type="email" class="form-control" placeholder="you@example.com" required>
        </div>
    
        <div class="form-group">
            <label for="password">Password</label>
            <input id="password" name="password" type="password" class="form-control" placeholder="••••••••" minlength="6" required>
        </div>
    
        <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <input id="confirmPassword" name="confirmPassword" type="password" class="form-control" placeholder="Re-enter your password" required>
        </div>
    
        <input type="hidden" id="role" name="role">
    
        <button type="submit" class="btn btn-primary w-100 mt-3">Sign Up</button>
    </form>

    <p style="text-align: center; margin-top: 1.5rem;">
        Already have an account? <a href="/login" style="color: #3d5a80; font-weight: 500;">Login instead</a>
    </p>
    
</div>
{% endblock %}

{% block scripts %}
<script>
function selectRole(role) {
    const buttons = document.querySelectorAll('.btn-role');
    buttons.forEach(btn => btn.classList.remove('active-role'));

    const selectedBtn = document.getElementById(`${role}-btn`);
    selectedBtn.classList.add('active-role');

    document.getElementById('role').value = role;
    document.getElementById('signupForm').style.display = 'block';
}

function submitSignup(event) {
    event.preventDefault();

    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    if (password !== confirmPassword) {
        alert('Passwords do not match!');
        return;
    }

    const data = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        password: password,
        role: document.getElementById('role').value
    };

    fetch('/api/signup', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(r => r.json())
    .then(response => {
        if (response.success) {
            window.location.href = response.redirect;
        } else {
            alert(response.message || 'Sign-up failed. Try again.');
        }
    })
    .catch(() => alert('Error during sign-up.'));
}
</script>
{% endblock %}